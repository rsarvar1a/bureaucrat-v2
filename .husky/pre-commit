if git diff --cached --name-only -- bureaucrat/schema | grep -qE '\.sql\.ts$'; then

  bun run db:generate || true
  echo ""

  git add migrations/

  if git diff --cached --name-only | grep -q '^migrations/'; then
    echo ""
    echo "New migrations were generated and staged."
    echo "Please rename the migration subfolder in a fixup commit."
    echo ""
  fi
else
  echo "No changes to SQL schema files detected. Skipping migration generation."
  echo ""
fi

bun run lint && bun run format
echo ""